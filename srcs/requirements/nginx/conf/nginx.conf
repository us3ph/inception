server {
    #listen on port 443 with SSL enabled
    listen 443 ssl;
    listen [::]:443 ssl; #IPv6 support

    #your domain name
    server_name ${DOMAIN_NAME};

    #SSL certificate files (we created these in the setup script)
    ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;
    ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;

    #only use TLS 1.3 (more secure than older versions)
    ssl_protocols TLSv1.3;

    #where the website files are located
    root /var/www/html;

    #default file to serve
    index index.php index.html index.htm;

    #handel regular resquests
    location / {
        #try to serve the file or folder or fallback to index.php
        try_files $uri $uri/ /index.php?$args;
    }

    #handel PHP files (wordpress is written in PHP)
    location ~ \.php$ {
        #send PHP requests to wordpress container on port 9000
        fastcgi_pass wordpress:9000;

        #use index.php as the default
        fastcgi_index index.php;

        #include FastCGI parameters
        include fastcgi_params;

        #tell PHP where the script is located
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }   
}





#  ### **Step 5.6: Understanding FastCGI**
#  
#  You might be wondering: **"What is FastCGI?"**
#  
#  **Without FastCGI (old way):**
#  ```
#  Nginx: "I have a PHP file, let me start PHP, run it, get result, kill PHP"
#  Nginx: "Another PHP file? Let me start PHP again, run it, get result, kill PHP"
#  ```
#  This is slow! Starting PHP every time is expensive.
#  
#  **With FastCGI (modern way):**
#  ```
#  Nginx: "Hey PHP-FPM, I have a PHP file for you"
#  PHP-FPM: "Got it! Here's the result"
#  (PHP-FPM stays running, ready for the next request)
#  ```
#  Much faster! PHP-FPM is a process manager that keeps PHP running.